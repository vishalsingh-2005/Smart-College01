{% extends 'base.html' %}
{% block title %}Attendance{% endblock %}
{% block content %}
<h1>üìä Attendance Records</h1>

{% if user.profile.role == 'student' %}
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin: 30px 0;">
    <div class="stats-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
        <h3 style="margin: 0; font-size: 36px;">{{ total_present }}</h3>
        <p style="margin: 5px 0 0; opacity: 0.9;">Present</p>
    </div>
    
    <div class="stats-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
        <h3 style="margin: 0; font-size: 36px;">{{ total_absent }}</h3>
        <p style="margin: 5px 0 0; opacity: 0.9;">Absent</p>
    </div>
    
    <div class="stats-card" style="background: linear-gradient(135deg, #ffc371 0%, #ff5f6d 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
        <h3 style="margin: 0; font-size: 36px;">{{ total_late }}</h3>
        <p style="margin: 5px 0 0; opacity: 0.9;">Late</p>
    </div>
    
    <div class="stats-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white; padding: 20px; border-radius: 10px; text-align: center;">
        <h3 style="margin: 0; font-size: 36px;">{{ attendance_percentage }}%</h3>
        <p style="margin: 5px 0 0; opacity: 0.9;">Attendance</p>
    </div>
</div>

<div style="background: white; padding: 30px; border-radius: 10px; margin: 30px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
    <h2 style="margin-top: 0;">üìà Attendance Trend (Last 30 Days)</h2>
    <canvas id="attendanceChart" width="400" height="150"></canvas>
</div>
{% endif %}

<div style="background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
    <h2 style="margin-top: 0;">üìã Recent Attendance Records</h2>
    <table style="width: 100%;">
        <thead>
            <tr>
                <th>Student</th>
                <th>Date</th>
                <th>Time</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for att in attendance_records %}
            <tr>
                <td>{{ att.student.username }}</td>
                <td>{{ att.date }}</td>
                <td>{{ att.time|date:"H:i" }}</td>
                <td>
                    {% if att.status == 'present' %}
                    <span style="background: #43e97b; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px;">‚úì Present</span>
                    {% elif att.status == 'absent' %}
                    <span style="background: #f5576c; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px;">‚úó Absent</span>
                    {% else %}
                    <span style="background: #ffc371; color: white; padding: 5px 10px; border-radius: 15px; font-size: 12px;">‚è∞ Late</span>
                    {% endif %}
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="4" style="text-align: center; padding: 20px; color: #999;">No attendance records found</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div style="margin-top: 20px;">
    <a href="{% url 'dashboard' %}" class="btn">Back to Dashboard</a>
</div>

{% if user.profile.role == 'student' %}
<script>
    const ctx = document.getElementById('attendanceChart').getContext('2d');
    const attendanceChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: {{ chart_labels|safe }},
            datasets: [{
                label: 'Attendance',
                data: {{ chart_data|safe }},
                borderColor: '#667eea',
                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: '#667eea',
                pointBorderColor: '#fff',
                pointBorderWidth: 2,
                pointRadius: 5,
                pointHoverRadius: 7
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.parsed.y === 1 ? 'Present' : 'Absent';
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 1,
                    ticks: {
                        stepSize: 1,
                        callback: function(value) {
                            return value === 1 ? 'Present' : 'Absent';
                        }
                    },
                    grid: {
                        color: 'rgba(0, 0, 0, 0.05)'
                    }
                },
                x: {
                    grid: {
                        color: 'rgba(0, 0, 0, 0.05)'
                    }
                }
            }
        }
    });
</script>
{% endif %}
{% endblock %}
