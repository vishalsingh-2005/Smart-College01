{% extends 'base.html' %}

{% block content %}
<div class="container">
    <h1>Make Payment</h1>

    <div class="card">
        <h2>{{ fee_structure.name }}</h2>
        <p><strong>Description:</strong> {{ fee_structure.description }}</p>
        <p><strong>Amount:</strong> <span style="font-size: 24px; color: var(--primary-color); font-weight: bold;">â‚¹{{ fee_structure.amount }}</span></p>
        <p><strong>Due Date:</strong> {{ fee_structure.due_date }}</p>
    </div>

    <div class="card" style="margin-top: 20px;">
        <h3>Payment Options</h3>
        <p>Click the button below to proceed with secure payment via Razorpay.</p>
        <p style="color: var(--text-secondary); font-size: 14px;">
            âœ“ Credit Card | Debit Card | UPI | Net Banking | Wallets
        </p>
        
        <button id="rzp-button" class="btn" style="margin-top: 20px; font-size: 16px; padding: 15px 30px;">
            ðŸ’³ Pay â‚¹{{ fee_structure.amount }} Securely
        </button>
        
        <a href="{% url 'view_student_fees' %}" class="btn btn-secondary" style="margin-top: 20px;">Cancel</a>
    </div>

    <div class="card" style="margin-top: 20px; background: var(--bg-secondary);">
        <h4 style="margin-top: 0;">ðŸ”’ Secure Payment</h4>
        <p style="font-size: 14px; color: var(--text-secondary); margin-bottom: 0;">
            Your payment is secured by Razorpay. We never store your card details. All transactions are encrypted and secure.
        </p>
    </div>
</div>

<form id="razorpay-form" action="{% url 'verify_payment' %}" method="POST" style="display: none;">
    {% csrf_token %}
    <input type="hidden" name="razorpay_payment_id" id="razorpay_payment_id">
    <input type="hidden" name="razorpay_order_id" id="razorpay_order_id">
    <input type="hidden" name="razorpay_signature" id="razorpay_signature">
</form>

<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script>
document.getElementById('rzp-button').onclick = function(e) {
    e.preventDefault();
    
    var options = {
        "key": "{{ razorpay_key_id }}",
        "amount": "{{ amount }}",
        "currency": "INR",
        "name": "SmartCollege",
        "description": "{{ fee_structure.name }}",
        "order_id": "{{ razorpay_order_id }}",
        "prefill": {
            "name": "{{ user_name }}",
            "email": "{{ user_email }}",
            "contact": "{{ user_phone }}"
        },
        "theme": {
            "color": "#007bff"
        },
        "handler": function (response) {
            document.getElementById('razorpay_payment_id').value = response.razorpay_payment_id;
            document.getElementById('razorpay_order_id').value = response.razorpay_order_id;
            document.getElementById('razorpay_signature').value = response.razorpay_signature;
            document.getElementById('razorpay-form').submit();
        },
        "modal": {
            "ondismiss": function() {
                alert('Payment cancelled. You can try again when ready.');
            }
        }
    };
    
    var rzp = new Razorpay(options);
    rzp.open();
};
</script>
{% endblock %}
